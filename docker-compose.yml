version: '3.8'

services:
  govee-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: govee-mcp-server:latest
    container_name: govee-mcp-server
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - GOVEE_API_KEY=${GOVEE_API_KEY:?GOVEE_API_KEY is required}
      - MCP_CLIENT_TOKENS=${MCP_CLIENT_TOKENS:-}
      - DEVICE_CACHE_TTL_MS=${DEVICE_CACHE_TTL_MS:-300000}
      - PER_CLIENT_RATE_LIMIT=${PER_CLIENT_RATE_LIMIT:-100}
      - RATE_LIMIT_WINDOW_MS=${RATE_LIMIT_WINDOW_MS:-60000}
      - MAX_RETRIES=${MAX_RETRIES:-3}
      - INITIAL_BACKOFF_MS=${INITIAL_BACKOFF_MS:-1000}
      - MAX_BACKOFF_MS=${MAX_BACKOFF_MS:-30000}
      - COALESCE_WINDOW_MS=${COALESCE_WINDOW_MS:-200}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/healthz"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
